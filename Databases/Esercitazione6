-- Esercizio 1
EXPLAIN(SELECT CS.nome
FROM CorsoStudi AS CS
WHERE CS.nome ILIKE '%informatica')

-- Con indice
CREATE INDEX CS_nome_index ON CorsoStudi(nome varchar_pattern_ops);
ANALYZE CorsoStudi;

-- Risposta: non cambia nulla, non si può utilizzare l'indice

-- Esercizio 2
EXPLAIN(SELECT I.nomeins
FROM Insegn AS I
WHERE I.nomeins LIKE 'Teoria%')

-- Con indice
CREATE INDEX I_nomeins ON Insegn(nomeins varchar_pattern_ops);
ANALYZE Insegn;

-- Risposta: si passa dai 198 accessi ai 47

-- Esercizio 3
EXPLAIN
SELECT I.nomeins, IE.id_facolta
FROM InsErogato AS IE JOIN Insegn AS I ON IE.id_insegn = I.id
WHERE IE.annoaccademico = '2013/2014'

-- Con indice
CREATE INDEX IE_id_insegn ON InsErogato(id_insegn); 
CREATE INDEX IE_annoaccademico ON InsErogato USING hash(annoaccademico);
ANALYZE InsErogato;

-- Risposta: si passa dai 6320 accessi ai 3981

-- Esercizio 4
EXPLAIN
SELECT CS.nome, CS.codice, CS.abbreviazione
FROM CorsoStudi AS CS
WHERE CS.nome ILIKE '%lingue%'

-- Con indice
-- Non usa l'indice anche se è già definito dal punto 1

-- Esercizio 5
EXPLAIN
SELECT IE.id, IE.modulo
FROM InsErogato AS IE
WHERE IE.modulo > 0 AND IE.annoaccademico = '2010/2011' AND IE.id_facolta = 7

-- Con indice
CREATE INDEX IE_annoaccademico ON InsErogato USING hash(annoaccademico); 
CREATE INDEX IE_id_facolta ON InsErogato(id_facolta);
CREATE INDEX IE_modulo ON InsErogato(modulo);
ANALYZE InsErogato;

-- Risposta: si passa dai 6310 accessi ai 1477

-- Esercizio 6
EXPLAIN
SELECT I.nomeins, D.descrizione
FROM Discriminante AS D JOIN InsErogato AS IE ON D.id = IE.id_discriminante JOIN Insegn AS I ON I.ID = IE.id_insegn
WHERE IE.annoaccademico = '2009/2010' AND IE.crediti IN (3, 5, 12) AND IE.modulo <= 0

-- Con indice
CREATE INDEX IE_annoaccademico ON InsErogato(annoaccademico varchar_pattern_ops);
CREATE INDEX IE_crediti ON InsErogato USING hash(crediti);
ANALYZE InsErogato;


-- Risposta: si passa da 6701 accessi a

-- Esercizio 7
EXPLAIN
SELECT I.nomeins, D.descrizione
FROM Discriminante AS D JOIN InsErogato AS IE ON D.id = IE.id_discriminante JOIN Insegn AS I ON I.ID = IE.id_insegn
WHERE IE.annoaccademico = '2009/2010' AND IE.modulo <= 0 AND IE.crediti > 9

-- Con indice

-- Risposta: si passa da 6604 accessi a 

-- Esercizio 8
EXPLAIN
SELECT I.nomeins, D.descrizione, IE.crediti, IE.annierogazione
FROM Discriminante AS D JOIN InsErogato AS IE ON D.id = IE.id_discriminante JOIN Insegn AS I ON I.ID = IE.id_insegn JOIN CorsoStudi AS CS ON CS.id = IE.id_corsostudi
WHERE IE.annoaccademico = '2013/2014' AND IE.modulo = 0 AND CS.nome LIKE 'Laurea in Informatica'
ORDER BY I.nomeins, D.descrizione, IE.crediti, IE.annierogazione

-- Con indice

-- Risposta: si passa da 6399 accessi a 

-- Esercizio 9
EXPLAIN
SELECT MAX(IE.crediti) AS massimo
FROM InsErogato AS IE
WHERE IE.annoaccademico = '2013/2014'

-- Con indice

-- Risposta: si passa da 5983 accessi a 

-- Esercizio 10
EXPLAIN
SELECT IE.annoaccademico, MAX(IE.crediti) AS massimo, MIN(IE.crediti) AS minimo
FROM InsErogato AS IE
WHERE IE.modulo = 0
GROUP BY IE.annoaccademico

-- Con indice

-- Risposta: si passa da 6315 accessi a 

-- Esercizio 11
EXPLAIN
SELECT CS.nome
FROM InsErogato AS IE JOIN Insegn AS I ON I.ID = IE.id_insegn JOIN CorsoStudi AS CS ON CS.id = IE.id_corsostudi

EXCEPT 

SELECT CS.nome
FROM InsErogato AS IE JOIN Insegn AS I ON I.ID = IE.id_insegn JOIN CorsoStudi AS CS ON CS.id = IE.id_corsostudi
WHERE I.nomeins ILIKE '%matematica%'

-- Con indici

-- Risposta: si passa da 9860 accessi a

-- Esercizio 12
EXPLAIN
SELECT IE.annoaccademico, CS.nome, SUM(IE.crediti) AS somma, MAX(IE.crediti) AS massimo, MIN(IE.crediti) AS minimo
FROM InsErogato AS IE JOIN CorsoStudi AS CS ON IE.id_corsostudi = CS.id
WHERE IE.modulo = 0
GROUP BY IE.annoaccademico, CS.nome

-- Con indice

-- Risposta: si passa da 7408 accessi a 